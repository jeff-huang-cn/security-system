<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.webapp.security.core.mapper.SysPermissionMapper">

    <!-- 根据权限编码查询权限 -->
    <select id="selectByPermCode" resultType="com.webapp.security.core.entity.SysPermission">
        SELECT * FROM sys_permission WHERE perm_code = #{permCode} AND deleted = 0
    </select>

    <!-- 根据父权限ID查询子权限列表 -->
    <select id="selectByParentId" resultType="com.webapp.security.core.entity.SysPermission">
        SELECT * FROM sys_permission 
        WHERE parent_id = #{parentId} AND status = 1 AND deleted = 0 
        ORDER BY sort_order
    </select>

    <!-- 查询所有启用的权限 -->
    <select id="selectAllEnabled" resultType="com.webapp.security.core.entity.SysPermission">
        SELECT * FROM sys_permission 
        WHERE status = 1 AND deleted = 0 
        ORDER BY sort_order
    </select>

    <!-- 根据权限类型查询权限列表 -->
    <select id="selectByPermType" resultType="com.webapp.security.core.entity.SysPermission">
        SELECT * FROM sys_permission 
        WHERE perm_type = #{permType} AND status = 1 AND deleted = 0 
        ORDER BY sort_order
    </select>

    <!-- 根据角色ID查询权限列表 -->
    <select id="selectByRoleId" resultType="com.webapp.security.core.entity.SysPermission">
        SELECT sp.* FROM sys_permission sp 
        JOIN sys_role_permission srp ON sp.permission_id = srp.permission_id 
        WHERE srp.role_id = #{roleId} 
        AND sp.status = 1 AND sp.deleted = 0 
        ORDER BY sp.sort_order
    </select>

    <!-- 根据用户ID查询权限列表 -->
    <select id="selectByUserId" resultType="com.webapp.security.core.entity.SysPermission">
        SELECT DISTINCT sp.* FROM sys_permission sp 
        JOIN sys_role_permission srp ON sp.permission_id = srp.permission_id 
        JOIN sys_user_role sur ON srp.role_id = sur.role_id 
        WHERE sur.user_id = #{userId} 
        AND sp.status = 1 AND sp.deleted = 0 
        ORDER BY sp.sort_order
    </select>
    
</mapper>